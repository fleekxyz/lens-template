var t=require("wonka"),r=require("@urql/core");function e(){return(e=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t}).apply(this,arguments)}function n(t,n){return r.makeOperation(t.kind,t,e({},t.context,{authAttempt:n}))}exports.authExchange=function(e){var u=e.addAuthToOperation,a=e.getAuth,o=e.didAuthError,i=e.willAuthError;return function(e){var c=e.client,f=e.forward,h=new Map,l=t.makeSubject(),p=l.source,m=l.next,s=null;return function(e){function l(e,n,u){var a=c.createRequestOperation("mutation",r.createRequest(e,n),u);return t.toPromise(t.take(1)(t.filter((function(t){return t.operation.key===a.key}))(t.onStart((function(){return m(a)}))(A))))}function k(t){s=t,d=void 0,h.forEach(m),h.clear()}var d=Promise.resolve().then((function(){return a({authState:s,mutate:l})})).then(k);function v(t){t=n(t,!0),h.set(t.key,t),d||(d=a({authState:s,mutate:l}).then(k).catch((function(){return k(null)})))}var y=t.share(e),w=t.filter((function(t){return"teardown"===t.kind}))(y),g=t.filter((function(t){return"teardown"!==t.kind}))(y),S=t.map((function(t){return u({operation:t,authState:s})}))(t.merge([p,t.mergeMap((function(r){if(h.has(r.key))return t.empty;if(!d&&i&&i({operation:r,authState:s}))return v(r),t.empty;if(!d)return t.fromValue(n(r,!1));var e=t.filter((function(t){return"teardown"===t.kind&&t.key===r.key}))(y);return t.takeUntil(e)(t.map((function(){return n(r,!1)}))(t.fromPromise(d)))}))(g)])),A=t.share(f(t.merge([S,w])));return t.filter((function(t){var r=t.error,e=t.operation;return!(r&&o&&o({error:r,authState:s})&&!e.context.authAttempt&&(v(e),1))}))(A)}}};
//# sourceMappingURL=urql-exchange-auth.min.js.map
