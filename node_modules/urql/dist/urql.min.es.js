import{createClient as e,createRequest as t}from"@urql/core";export*from"@urql/core";import{createContext as n,useContext as r,useRef as u,useState as i,useCallback as o,useEffect as c,useMemo as a}from"react";import{toPromise as f,subscribe as s,onPush as l,takeWhile as v,onEnd as d}from"wonka";var p=n(e({url:"/graphql"})),y=p.Provider,h=p.Consumer;function x(){return r(p)}function g(){return(g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}p.displayName="UrqlContext";var b={fetching:!1,stale:!1,error:void 0,data:void 0,extensions:void 0,operation:void 0};function q(e,t){var n=g({},e,t,{data:void 0!==t.data||t.error?t.data:e.data,fetching:!!t.fetching,stale:!!t.stale});return function(e,t){if("object"!=typeof e||"object"!=typeof t)return e!==t;for(var n in e)if(!(n in t))return!0;for(var r in t)if(e[r]!==t[r])return!0;return!1}(e,n)?n:e}function k(e,t){for(var n=0,r=t.length;n<r;n++)if(e[n]!==t[n])return!0;return!1}function m(e){var n=u(!0),r=x(),a=i(b),s=a[0],l=a[1],v=o((function(u,i){return l(g({},b,{fetching:!0})),f(r.executeMutation(t(e,u),i||{})).then((function(e){return n.current&&l({fetching:!1,stale:!!e.stale,data:e.data,error:e.error,extensions:e.extensions,operation:e.operation}),e}))}),[r,e,l]);return c((function(){return n.current=!0,function(){n.current=!1}}),[]),[s,v]}function P(e,n){var r=u(void 0);return a((function(){var u=t(e,n);return void 0!==r.current&&r.current.key===u.key?r.current:(r.current=u,u)}),[e,n])}var w=!1;function j(e){var t=x(),n=function(e){if(!e._react){var t=new Set,n=new Map;e.operations$&&s((function(e){"teardown"===e.kind&&t.has(e.key)&&(t.delete(e.key),n.delete(e.key))}))(e.operations$),e._react={get:function(e){return n.get(e)},set:function(e,r){t.delete(e),n.set(e,r)},dispose:function(e){t.add(e)}}}return e._react}(t),r=function(e,t){return e.suspense&&(!t||!1!==t.suspense)}(t,e.context),u=P(e.query,e.variables),f=a((function(){if(e.pause)return null;var i=t.executeQuery(u,g({},{requestPolicy:e.requestPolicy},e.context));return r?l((function(e){n.set(u.key,e)}))(i):i}),[n,t,u,r,e.pause,e.requestPolicy,e.context]),p=o((function(e,t){if(!e)return{fetching:!1};var r=n.get(u.key);if(r){if(t&&null!=r&&"then"in r)throw r}else{var i,o=s((function(e){r=e,i&&i(r)}))(v((function(){return t&&!i||!r}))(e));if(null==r&&t){var c=new Promise((function(e){i=e}));throw n.set(u.key,c),c}o.unsubscribe()}return r||{fetching:!0}}),[n,u]),y=[t,u,e.requestPolicy,e.context,e.pause],h=i((function(){w=!0;try{return[f,q(b,p(f,r)),y]}finally{w=!1}})),m=h[0],j=h[1],Q=m[1];return f!==m[0]&&k(m[2],y)&&j([f,Q=q(m[1],p(f,r)),y]),c((function(){var e=m[0],t=m[2][1],r=!1;function u(e){r=!0,w||j((function(t){var n=q(t[1],e);return t[1]!==n?[t[0],n,t[2]]:t}))}if(e){var i=s(u)(d((function(){u({fetching:!1})}))(e));return r||u({fetching:!0}),function(){n.dispose(t.key),i.unsubscribe()}}u({fetching:!1})}),[n,m[0],m[2][1]]),[Q,o((function(i){var o=g({},{requestPolicy:e.requestPolicy},e.context,i);j((function(e){return[r?l((function(e){n.set(u.key,e)}))(t.executeQuery(u,o)):t.executeQuery(u,o),e[1],y]}))}),[t,n,u,r,p,e.requestPolicy,e.context])]}function Q(e,t){var n=x(),r=P(e.query,e.variables),f=u(t);f.current=t;var l=a((function(){return e.pause?null:n.executeSubscription(r,e.context)}),[n,r,e.pause,e.context]),v=[n,r,e.context,e.pause],p=i((function(){return[l,g({},b,{fetching:!!l}),v]})),y=p[0],h=p[1],m=y[1];return l!==y[0]&&k(y[2],v)&&h([l,m=q(y[1],{fetching:!!l}),v]),c((function(){function e(e){h((function(t){var n=q(t[1],e);return t[1]===n?t:(f.current&&t[1].data!==n.data&&(n.data=f.current(t[1].data,n.data)),[t[0],n,t[2]])}))}if(y[0])return s(e)(d((function(){e({fetching:!1})}))(y[0])).unsubscribe;e({fetching:!1})}),[y[0]]),[m,o((function(t){var u=n.executeSubscription(r,g({},e.context,t));h((function(e){return[u,e[1],e[2]]}))}),[n,e.context,r])]}function S(e){var t=m(e.query);return e.children(g({},t[0],{executeMutation:t[1]}))}function M(e){var t=j(e);return e.children(g({},t[0],{executeQuery:t[1]}))}function O(e){var t=Q(e,e.handler);return e.children(g({},t[0],{executeSubscription:t[1]}))}export{h as Consumer,p as Context,S as Mutation,y as Provider,M as Query,O as Subscription,x as useClient,m as useMutation,j as useQuery,Q as useSubscription};
//# sourceMappingURL=urql.min.es.js.map
